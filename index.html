<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>vsPhone Web</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      margin: 0;
      background: #0f0f0f;
      color: #fff;
      font-family: Arial, sans-serif;
    }
    #phoneBox {
      width: 100vw;
      height: 80vh;
      background: #333;
    }
    .controls {
      display: flex;
      gap: 10px;
      padding: 10px;
    }
    button {
      padding: 10px 16px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <div id="phoneBox"></div>

  <div class="controls">
    <button onclick="joinRoom()">Join Room</button>
    <button onclick="leaveRoom()">Leave Room</button>
  </div>

  <script type="module">
    import { ArmcloudEngine } from
      "https://cdn.jsdelivr.net/npm/armcloud-rtc/+esm";

    let armCloud = null;

    async function joinRoom() {
      if (armCloud) return;

      const padCode = "AC22030020000"; // ðŸ”´ CHANGE THIS
      const userId = crypto.randomUUID();

      // Get token from server
      const res = await fetch(
        `/api/token?padCode=${padCode}&userId=${userId}`
      );
      const json = await res.json();

      if (!json?.data?.token) {
        alert("Token fetch failed");
        return;
      }

      armCloud = new ArmcloudEngine({
        baseUrl: "https://openapi-hk.armcloud.net",
        token: json.data.token,
        viewId: "phoneBox",
        deviceInfo: {
          padCode,
          userId,
          mediaType: 3
        },
        callbacks: {
          onInit: async ({ code, msg }) => {
            console.log("Init:", code, msg);
            if (code === 0) {
              const supported = await armCloud.isSupported();
              if (!supported) {
                alert("Browser does not support WebRTC");
                return;
              }
              armCloud.start();
            }
          },
          onConnectSuccess: () => {
            console.log("Connected to vsPhone");
          },
          onConnectFail: ({ msg }) => {
            alert("Connection failed: " + msg);
          }
        }
      });
    }

    function leaveRoom() {
      if (armCloud) {
        armCloud.stop();
        armCloud = null;
      }
    }

    window.joinRoom = joinRoom;
    window.leaveRoom = leaveRoom;
  </script>

</body>
</html>
