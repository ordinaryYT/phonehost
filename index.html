<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>vsPhone Web</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { margin:0; background:#111; color:#fff; font-family: Arial,sans-serif; }
    #phoneBox { width:100vw; height:80vh; background:#333; }
    .controls { display:flex; gap:10px; padding:10px; }
    button { padding:10px 16px; font-size:16px; cursor:pointer; }
  </style>
</head>
<body>

  <div id="phoneBox"></div>

  <div class="controls">
    <button id="joinBtn">Join Room</button>
    <button id="leaveBtn">Leave Room</button>
  </div>

  <script type="module">
    import { ArmcloudEngine } from "/index.es.js"; // ðŸ‘ˆ SDK file in root

    let armCloud = null;

    async function joinRoom() {
      console.log("Join clicked");

      const padCode = "ACP5CI50MU5UKG02"; // âœ… YOUR PAD CODE
      const userId = crypto.randomUUID();

      const res = await fetch(
        `/api/token?padCode=${padCode}&userId=${userId}`
      );
      const json = await res.json();

      if (!json?.data?.token) {
        alert("Failed to get token");
        return;
      }

      armCloud = new ArmcloudEngine({
        baseUrl: "https://openapi-hk.armcloud.net",
        token: json.data.token,
        viewId: "phoneBox",
        deviceInfo: {
          padCode,
          userId,
          mediaType: 3
        },
        callbacks: {
          onInit: async ({ code, msg }) => {
            console.log("onInit:", code, msg);
            if (code === 0) {
              const supported = await armCloud.isSupported();
              if (!supported) {
                alert("WebRTC not supported");
                return;
              }
              armCloud.start();
            }
          },
          onConnectSuccess: () => {
            console.log("Connected to vsPhone");
          },
          onConnectFail: ({ msg }) => {
            alert("Connection failed: " + msg);
          }
        }
      });
    }

    function leaveRoom() {
      if (armCloud) {
        armCloud.stop();
        armCloud = null;
      }
    }

    document.getElementById("joinBtn").addEventListener("click", joinRoom);
    document.getElementById("leaveBtn").addEventListener("click", leaveRoom);
  </script>

</body>
</html>
